# APE 명령어 시스템 구현 계획 (역할자 1)

이 문서는 APE(Agentic Pipeline Engine) 확장 프로그램의 명령어 시스템 개선을 위한 단계적 구현 계획을 설명합니다. 역할자 1은 명령어 시스템의 핵심 구성 요소를 개발하는 역할을 담당합니다.

## 진행 상황 요약 (2025-05-05)

현재까지 다음 작업이 완료되었습니다:

1. **CommandTypes 인터페이스 개선** (완료)
   - 이중 접두사 시스템 및 도메인 기반 명령어 구조 지원
   - 명령어 도메인 열거형 추가 및 인터페이스 확장
   - 명령어 핸들러 및 결과 타입 정의 완료

2. **명령어 파서 서비스 개선** (완료)
   - 이중 접두사 및 도메인 기반 구문 분석 로직 구현
   - 오타 감지 및 명령어 추천 기능 구현
   - 하위 명령어 및 옵션 처리 기능 추가

3. **명령어 레지스트리 서비스 고도화** (진행 중)
   - 도메인 기반 명령어 등록 및 검색 기능 구현 중
   - 컨텍스트 인식 명령어 추천 시스템 개발 중

다음 단계로 명령어 실행기 서비스 구현과 확장 프로그램 진입점 통합이 계획되어 있습니다.

## 작업 개요

APE 확장 프로그램의 명령어 시스템은 이중 접두사(`/`, `@`)를 사용하여 다음과 같이 명령어를 구분합니다:

- `/` 접두사: 시스템 명령어 (UI 제어, 설정, 채팅 관리 등)
- `@` 접두사: 에이전트 명령어 (LLM 기반 고급 기능, 도메인별 작업)

에이전트 명령어는 도메인 중심 계층 구조를 따릅니다:
```
@<도메인>:<동작>[:<세부옵션>]
```

## 구현 단계

### 1단계: CommandTypes 인터페이스 개선
- 이중 접두사 시스템을 지원하는 타입 정의 확장
- 도메인 기반 명령어 구조를 위한 인터페이스 추가
- 명령어 실행 결과에 대한 타입 정의

### 2단계: 명령어 파서 서비스 개선
- 이중 접두사 및 도메인 기반 명령어 구문 분석 로직 구현
- 중첩된 명령어 옵션 파싱 지원
- 오타 감지 및 추천 기능 구현

### 3단계: 명령어 레지스트리 서비스 고도화
- 도메인 기반 명령어 등록 및 검색 기능 개선
- 컨텍스트 인식 명령어 추천 시스템 구현
- 동적 명령어 생성 지원

### 4단계: 명령어 실행기 서비스 개선
- 향상된 에러 처리 및 실행 결과 포맷팅
- 비동기 명령어 실행 지원
- 명령어 실행 이력 관리

### 5단계: 확장 프로그램 진입점 통합
- 코어 명령어 시스템과 확장 프로그램 통합
- VS Code 명령어 팔레트 연동
- 상태 표시줄 및 UI 연동

## 마일스톤 및 체크리스트

### 마일스톤 1: 명령어 시스템 개발 (2-3주)
- [ ] CommandTypes 인터페이스 개선
- [ ] 명령어 파서 서비스 개선
- [ ] 명령어 레지스트리 서비스 고도화
- [ ] 명령어 실행기 서비스 개선
- [ ] 기본 시스템 명령어(`/`) 구현
- [ ] 단위 테스트 작성

### 마일스톤 2: 구현 테스트 (1주)
- [ ] 기본 에이전트 명령어(`@`) 구현
- [ ] 명령어 자동 완성 기초 기능 구현
- [ ] 오류 처리 및 피드백 개선
- [ ] 통합 테스트 작성
- [ ] 성능 최적화

### 마일스톤 3: 통합 테스트 (1주)
- [ ] 역할자 2(도메인 서비스)와의 통합
- [ ] 역할자 3(UI/UX)와의 통합
- [ ] 사용자 피드백 반영
- [ ] 문서화 및 예제 작성
- [ ] 최종 검증 및 배포 준비

## 크로스 체크 사항

### 역할자 2(도메인 서비스)와의 협력 사항
- 도메인별 명령어 형식 및 인터페이스 표준화
- 플러그인 시스템과 명령어 시스템 간 연동
- LLM 서비스와 명령어 처리 흐름 조정

### 역할자 3(UI/UX)와의 협력 사항
- 명령어 자동 완성 UI 인터페이스 정의
- 명령어 실행 결과 표시 방식 조정
- 명령어 디스커버리 UX 개선 협력

## 진행 상황 보고

구현이 진행됨에 따라 각 단계별 진행 상황과 체크리스트 완료 여부를 이 문서에 업데이트하여 다른 역할자들이 진행 상황을 쉽게 파악할 수 있도록 합니다.

---

# 구현 진행 상황

## [날짜: 2025-05-05] 1단계 완료: CommandTypes 인터페이스 개선
- 작업 완료 파일: `src/types/CommandTypes.ts`
- 주요 변경 사항:
  - 이중 접두사 시스템 및 도메인 기반 타입 정의 완료
  - 명령어 도메인 열거형(CommandDomain) 추가: git, doc, jira, pocket, vault, rules
  - Command 및 ParsedCommand 인터페이스 확장: domain, subCommand, options 속성 추가
  - ICommand 인터페이스 확장: examples, group, shortcut, frequent 속성 추가
  - CommandResult 인터페이스 추가: 명령어 실행 결과 표준화
  - ICommandRegistry 및 ICommandExecutor 인터페이스 확장: 도메인 기반 메서드 추가
  - ICommandParser 인터페이스 확장: 오타 감지 및 추천 기능 추가

## [날짜: 2025-05-05] 2단계 완료: 명령어 파서 서비스 개선
- 작업 완료 파일: `src/core/command/CommandParserService.ts`
- 주요 개선 사항:
  - 이중 접두사 및 도메인 기반 명령어 구문 분석 로직 구현 완료
  - CommandDomain 열거형에 따른 도메인 추출 기능 추가
  - 중첩된 명령어 옵션 파싱 지원 (key=value 형식)
  - 오타 감지 및 추천 기능 구현 (레벤슈타인 거리 알고리즘 사용)
  - parseWithSuggestions 메서드 구현으로 유사 명령어 제안 기능 추가
  - 이스케이프 문자 및 따옴표 처리 강화로 복잡한 명령어 처리 개선
  - 하위 명령어(subCommand) 파싱 지원으로 도메인:명령어:하위명령어 형식 처리

## [날짜: 2025-05-05] 3단계 진행 중: 명령어 레지스트리 서비스 고도화
- 현재 작업 중인 파일: `src/core/command/CommandRegistryService.ts`
- 구현 중인 기능:
  - 도메인 기반 명령어 등록 및 검색 기능 구현
  - 컨텍스트 인식 명령어 추천 시스템 개발
  - 동적 명령어 생성 기능 추가
  - registerAgentCommand 및 registerSystemCommand 메서드 구현
  - 명령어 그룹화 및 분류 기능 구현
  - 확장된 명령어 사용법 등록 기능 구현

- 추가 개선 사항:
  - CommandRegistryService에 도메인 핸들러 관리 기능 추가
  - _contextCache 속성 추가로 명령어 추천 시스템 지원
  - CommandDomain 지원을 위한 데이터 구조 확장

## [날짜: 2025-05-05] 역할자 간 협업 체크포인트
1. 역할자 2(도메인 서비스)와의 협력 사항
   - CommandTypes의 도메인 열거형 확인 필요 - Git, Jira, Pocket 등이 정의되었습니다.
   - 플러그인 등록 시 도메인 기반으로 명령어를 등록하도록 안내가 필요합니다.
   - 각 도메인에서 공통된 명령어 이름 규칙을 사용하면 좋습니다(예: git:commit-message, jira:create 등).

2. 역할자 3(UX 개선)과의 협력 사항
   - CommandResult 인터페이스에 displayMode 필드가 추가되어 UI에서 처리 방식을 지정할 수 있습니다.
   - 명령어 자동완성을 위해 CommandParserService.suggestSimilarCommands() 메서드를 활용할 수 있습니다.
   - CommandRegistry.getAllDomainCommands()를 통해 도메인별 명령어를 조회해 UI에 표시할 수 있습니다.

(이후 진행 상황이 업데이트될 예정입니다)