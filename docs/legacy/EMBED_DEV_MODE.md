# 심층 분석 모드 (Embed Dev Mode) 설계 문서

## 개요

심층 분석 모드는 APE 확장 프로그램의 고급 기능으로, 프롬프트 엔지니어링을 고도화하고 내부 데이터 소스에 접근하여 복잡한 디버깅, 리팩토링, 로그 분석 작업을 지원합니다. 이 모드는 단순한 코드 완성을 넘어 심층적인 코드 이해와 최적화된 문제 해결을 목표로 합니다.

## 현재 구현 상태

현재 버전에서는 기본 프레임워크만 구현되어 있으며, 다음 기능이 포함됩니다:

1. UI에 심층 분석 모드 토글 버튼 추가
2. 설정에 embedDevMode 상태 저장
3. LLM 요청에 embedDevMode 플래그 전달
4. 심층 분석 모드가 활성화되었을 때 강화된 시스템 프롬프트 생성

## 향후 구현 계획

### 1. 내부망 데이터 액세스 레이어

- **narrans API 통합**: 내부 AI 모델과 데이터 저장소에 접근
- **내부 로그 서버 연결**: 실시간 및 저장된 로그 데이터 분석
- **내부 지식 베이스 통합**: 회사 내부 문서 및 코드 저장소 참조
- **보안 인증 관리**: 내부망 리소스에 대한 안전한 액세스 보장

### 2. 컨텍스트 수집 및 통합

- **코드베이스 심층 스캔**: 관련 모듈 및 의존성 자동 식별
- **심층 정적 분석**: 코드 품질, 복잡도, 취약점 자동 분석
- **실행 컨텍스트 추적**: 현재 실행 상태 및 변수 값 수집
- **로그 패턴 분석**: 로그 데이터에서 패턴 및 이상 감지

### 3. 고급 프롬프트 엔지니어링

- **다중 단계 프롬프트**: 복잡한 질문을 단계별로 분해하여 처리
- **도메인 특화 프롬프트**: 특정 도메인 지식을 포함한 프롬프트 최적화
- **컨텍스트 길이 최적화**: 토큰 제한 내에서 최대 관련 정보 포함
- **피드백 루프**: 초기 응답에 기반한 추가 프롬프트 생성

### 4. 고급 분석 기능

- **디버깅 어시스턴트**: 오류 원인 심층 분석 및 해결책 제안
- **퍼포먼스 최적화**: 코드 성능 병목 식별 및 개선안 제시
- **아키텍처 개선**: 설계 패턴 및 구조 분석/제안
- **보안 취약점 분석**: 잠재적 보안 이슈 식별

### 5. 결과 통합 및 시각화

- **실행 가능한 해결책**: 바로 적용 가능한 코드 수정 제안
- **시각적 디버깅 보조**: 문제 해결 과정 시각화
- **문서화 지원**: 분석 결과의 자동 문서화

## 기술적 고려사항

1. **성능 최적화**:
   - 대용량 데이터 처리를 위한 비동기 및 병렬 처리
   - 메모리 사용량 최소화 전략
   - 네트워크 요청 최적화

2. **보안 및 개인정보**:
   - 민감 정보 필터링 및 제거
   - 액세스 권한 관리
   - 데이터 저장 및 전송 암호화

3. **확장성**:
   - 새로운 데이터 소스 쉽게 추가 가능
   - 플러그인 아키텍처로 기능 확장 지원
   - 다양한 분석 알고리즘 통합 가능

## 사용 사례

1. **복잡한 버그 디버깅**:
   - 여러 모듈에 걸친 복잡한 오류 원인 분석
   - 로그 패턴 분석을 통한 간헐적 오류 추적

2. **레거시 코드 리팩토링**:
   - 대규모 레거시 코드 분석 및 현대화 제안
   - 코드 중복, 안티패턴 식별 및 개선

3. **성능 최적화**:
   - 코드 성능 병목 심층 분석
   - 메모리 사용 및 실행 시간 최적화 제안

4. **보안 검토**:
   - 잠재적 보안 취약점 식별
   - 규정 준수 검증

## 관련 파일

- `/src/core/ApeCoreService.ts`: 심층 분석 모드 핵심 로직
- `/src/ui/ApeChatViewProvider.ts`: UI 관련 코드
- `/src/services/ChatService.ts`: 메시지 처리 흐름
- `/src/types/ConfigTypes.ts`: 설정 타입 정의
- `/src/types/LlmTypes.ts`: LLM 요청 옵션 정의
- `/resources/html/chat.html` 및 `/resources/css/chat.css`: UI 구현

---

**참고**: 이 문서는 심층 분석 모드의 계획된 기능을 설명하며, 현재 버전에서는 기본 프레임워크만 구현되어 있습니다. 구체적인 기능 구현은 추후 진행될 예정입니다.