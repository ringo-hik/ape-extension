<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${cspSource} https://unpkg.com 'unsafe-inline'; script-src ${cspSource} 'unsafe-inline'; img-src ${cspSource} data:; connect-src ${cspSource}; font-src ${cspSource} https://unpkg.com;">
  <title>APE 채팅</title>
  <link href="${cssUri}" rel="stylesheet">
  <link href="${claudeStyleCssUri}" rel="stylesheet">
  <link href="${codeBlocksCssUri}" rel="stylesheet">
  <link href="${commandAutocompleteCssUri}" rel="stylesheet">
  <link href="${contextSuggestionsCssUri}" rel="stylesheet">
  <link href="${codiconsUri}" rel="stylesheet">
  <link href="${apeIconsCssUri}" rel="stylesheet">
  <!-- 아이콘용 CSS -->
  <link href="${phosphorIconsCssUri}" rel="stylesheet">
  <link href="${webviewResourceBaseUri}/css/toolbar-icons.css" rel="stylesheet">
  <script>
    // 디버깅 헬퍼
    window.apeDebug = {
      log: function(message) {
        console.log('[APE Debug]:', message);
      }
    };
    
    // 페이지 로드 시 디버깅 메시지
    window.addEventListener('DOMContentLoaded', function() {
      apeDebug.log('채팅 인터페이스 로드됨');
      apeDebug.log('CSS URI: ${cssUri}');
      apeDebug.log('모델 선택기 URI: ${modelSelectorUri}');
      apeDebug.log('코드 블록 CSS URI: ${codeBlocksCssUri}');
    });
  </script>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <h1><span class="logo"><img src="${cspSource}/resources/ape_logo.svg" alt="APE Logo" class="header-logo"></span> APE 채팅</h1>
      <div id="modelSelector" class="model-selector"></div>
    </div>
    
    <div class="chat-messages" id="messages">
      <!-- 빈 상태 메시지 -->
      <div class="empty-state" id="emptyState">
        <div class="empty-state-icon"><img src="${cspSource}/resources/ape_logo.svg" alt="APE Logo" class="empty-state-logo"></div>
        <div class="empty-state-title">APE와 대화를 시작하세요</div>
        <div class="empty-state-text">질문이나 명령어를 입력하여 대화를 시작할 수 있습니다.</div>
      </div>
      
      <!-- 메시지는 여기에 추가됩니다 -->
    </div>
    
    <div class="chat-input-container">
      <div class="toolbar">
        <button class="toolbar-button" id="clearButton" title="대화 내용 지우기">
          <i class="ph ph-trash"></i> 지우기
        </button>
        <button class="toolbar-button" id="embedDevButton" title="심층 분석 모드 켜기/끄기">
          <i class="ph ph-scanner"></i> 심층 분석
        </button>
        <button class="toolbar-button" id="commandsButton" title="명령어 패널 열기/닫기">
          <i class="ph ph-terminal"></i> 명령어
        </button>
        <button class="toolbar-button toggle-button" id="apeToggleButton" title="APE 모드 켜기/끄기">
          <i class="ph ph-lightning"></i> APE 모드
        </button>
      </div>
      
      <div id="commandsPanelContainer" class="commands-panel-container" style="display: none;">
        <!-- 명령어 버튼 패널이 여기에 로드됩니다 -->
        <iframe id="commandsPanel" class="commands-panel" src="${commandsHtmlUri}"></iframe>
      </div>
      
      <div class="input-wrapper">
        <textarea id="chatInput" class="chat-input" placeholder="메시지 입력..." rows="1"></textarea>
        <button id="sendButton" class="send-button" disabled><i class="ph ph-paper-plane-right"></i></button>
      </div>
    </div>
  </div>

  <script src="${modelSelectorUri}"></script>
  <script src="${codeBlocksJsUri}"></script>
  <script src="${commandIconsJsUri}"></script>
  <script src="${commandAutocompleteJsUri}"></script>
  <!-- 개선된 컨텍스트 핸들러 -->
  <script src="${improvedContextHandlerJsUri}"></script>
  <!-- 워크플로우 분석기 -->
  <script src="${workflowAnalyzerJsUri}"></script>
  <script src="${hybridApeUiJsUri}"></script>
  <!-- 내장 JS 코드는 제거하고 hybrid-ape-ui.js를 사용 -->
  <script>
    // 콘솔에 초기화 상태만 표시
    console.log('APE 하이브리드 채팅 UI 초기화: hybrid-ape-ui.js, improved-context-handler.js, workflow-analyzer.js를 사용합니다.');
  </script>
</body>
</html>